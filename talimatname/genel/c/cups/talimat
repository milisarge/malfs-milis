# Tanım: CUPS yazdırma sistemi
# URL: http://www.cups.org
# Paketçi: milisarge
# Gerekler: avahi python gnutls xdg-utils gtk-update-icon-cache

isim=cups
surum=2.2.6
devir=1
kaynak=(https://github.com/apple/cups/archive/v2.2.6.tar.gz::$isim-$surum.tar.gz)

derle() {
	source /etc/blfs-bootscripts
	wget  http://www.linuxfromscratch.org/blfs/downloads/8.1/blfs-bootscripts-20170731.tar.bz2
        tar xvf blfs-bootscripts-20170731.tar.bz2
	cd $isim-$surum
	sed -i 's:555:755:g;s:444:644:g' Makedefs.in
	sed -i '/MAN.*.EXT/s:.gz::g' \
	configure config-scripts/cups-manpages.m4
	sed -i '/LIBGCRYPTCONFIG/d' config-scripts/cups-ssl.m4
	aclocal -I config-scripts
	autoconf -I config-scripts
	./configure --libdir=/usr/lib \
		--disable-systemd \
		--with-rcdir=/tmp/cupsinit \
		--with-system-groups=lpadmin \
		--with-docdir=/usr/share/cups/doc-$surum
	make
	make BUILDROOT=$PKG install

	rm -rf $PKG/tmp/cupsinit
	mkdir -p $PKG/usr/share/doc
	ln -svnf ../cups/doc-$surum $PKG/usr/share/doc/cups-$surum

	# Lanceur
	if [ ! -f $PKG/usr/share/applications/cups.desktop ]; then
		mkdir -p $PKG/usr/share/applications
		install -m644 desktop/cups.desktop \
		$PKG/usr/share/applications/cups.desktop
	fi
	# Startup Script
	cd ../blfs-bootscripts-20170731
	make DESTDIR=$PKG install-$isim

	# Supprimer les filtres faisant parti de cups-filters
	rm -rf $PKG/usr/share/cups/banners
	rm -rf $PKG/usr/share/cups/data/testprint
	# Mechant bug
	rm -r $PKG/tmp

	chmod 755 $PKG/etc

# Başlatıcı 
mkdir -pv $PKG/usr/share/applications &&
cat > $PKG/usr/share/applications/$isim.desktop << "EOF" &&
[Desktop Entry]
Categories=System;Printing;HardwareSettings;X-Red-Hat-Base;
Exec=/usr/bin/xdg-open http://localhost:631/
Icon=cups
StartupNotify=false
Terminal=false
Type=Application
Name=Manage Printing
Comment=CUPS Web Interface
Name[ca]=Gestor d'impressió
Comment[ca]=Interfície web de CUPS
Name[tr]=Yazıcı Yönetimi
Comment[tr]=CUPS için web arayüzü
Name[cs]=Správa tisku CUPS
Comment[cs]=Webové rozhraní CUPS
Name[de]=Druckerverwaltung
Comment[de]=CUPS Webinterface
Name[en_US]=Manage Printing
Comment[en_US]=CUPS Web Interface
Name[es]=Administrar impresión
Comment[es]=Interfaz Web de CUPS
Name[et]=Trükkimise haldur
Comment[et]=CUPS-i veebiliides
Name[eu]=Kudeatu inprimaketak
Comment[eu]=CUPSen web interfazea
Name[fr]=Gestionnaire d'impression
Comment[fr]=Interface Web de CUPS
Name[he]=נהל הדפסות
Comment[he]=ממשק דפדפן של CUPS
Name[id]=Manajemen Pencetakan
Comment[id]=Antarmuka Web CUPS
Name[it]=Gestione stampa
Comment[it]=Interfaccia web di CUPS
Name[ja]=印刷の管理
Comment[ja]=CUPS Web インタフェース
Name[pl]=Zarządzanie drukowaniem
Comment[pl]=Interfejs WWW CUPS
Name[ru]=Настройка печати
Comment[ru]=Настройка CUPS
Name[sv]=Hantera skrivare
Comment[sv]=CUPS webb-gränssnitt
Name[zh]=打印机管理
Comment[zh]=CUPS网页界面
Name[zh_TW]=印表管理
Comment[zh_TW]=CUPS 網頁介面
EOF


	# PAM
	cat > $PKG/etc/pam.d/cups << "EOF"
# Begin /etc/pam.d/cups

auth    include system-auth
account include system-account
session include system-session

# End /etc/pam.d/cups
EOF
}
